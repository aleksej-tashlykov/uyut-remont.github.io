const modal=document.querySelector(".modal"),form=document.querySelectorAll("form[data-form]"),fields=document.querySelectorAll(".field"),video=document.querySelectorAll(".video-link");let data={};document.addEventListener("DOMContentLoaded",(function(){const e=()=>{modal.classList.add("visually-hidden"),document.querySelector("body").style.overflow="auto"};document.querySelector("#modal-btn-open").addEventListener("click",()=>{modal.classList.remove("visually-hidden"),document.querySelector("body").style.overflow="hidden"}),document.querySelector("#modal-btn-close").addEventListener("click",e),document.addEventListener("click",t=>{t.target==modal&&e()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&e()});const t=(e,t)=>{for(const o in t)e.setAttribute(o,t[o])},o=e=>{let o=e.currentTarget;o.classList.add("visually-hidden");let l=document.createElement("iframe");switch(l.classList.add("video"),o.getAttribute("data-video")){case"dentalika":t(l,{src:"https://www.youtube.com/embed/EtLGaofWuwM?autoplay=1&modestbranding=1",allow:"autoplay"});break;case"doctora":t(l,{src:"https://www.youtube.com/embed/Cwcxdez_dhQ?autoplay=1&modestbranding=1",allow:"autoplay"});break;case"tekhservice":t(l,{src:"https://www.youtube.com/embed/uEOjRVP50FY?autoplay=1&modestbranding=1",allow:"autoplay"});break;case"review":t(l,{src:"https://www.youtube.com/embed/D-6NXZpAECc?autoplay=1&modestbranding=1",allow:"autoplay"})}o.parentElement.appendChild(l)};video.forEach(e=>{e.addEventListener("click",o)});const l=e=>{let t="";for(const o in e)t+=`${o}=${e[o]}&`;return t};const d=e=>{let t=document.createElement("p");t.classList.add("popup"),t.innerHTML=e,a(t),setTimeout((function(){r(t)}),1e3)},r=e=>{e.remove("popup"),0==document.querySelectorAll(".popup-wrap .popup").length&&document.querySelector(".popup-wrap").remove()},a=e=>{let t=document.querySelector(".popup-wrap");if(t)t.appendChild(e);else{let t=document.createElement("div");t.classList.add("popup-wrap"),document.querySelector("body").appendChild(t),t.appendChild(e)}},n=e=>{let t=e.target;""===t.value?(t.style.borderColor="#914848",d("Поле обязательно к заполнению!"),setTimeout((function(){t.style.borderColor="#dfdfdf"}),1e3)):""!==t.value&&(t.style.borderColor="#3A743A")},u=e=>{let t=e.target,o=t.value.replace(/\s+/g,"").trim();/[а-яёА-ЯЁ]/.test(o)||(t.value="",t.style.borderColor="#914848",d("Только кирилические символы!"),setTimeout((function(){t.style.borderColor="#dfdfdf"}),1e3))},s=e=>{let t=e.target;8==e.keyCode&&1==t.value.length&&(t.value="")},c=e=>e.value.replace(/\D/g,""),i=e=>{let t=e.target,o=c(t),l="";if(!o)return t.value="";if(["7","8","9"].indexOf(o[0])>-1){"9"==o[0]&&(o="7"+o),l=("8"==o[0]?"8":"+7")+" ",o.length>1&&(l+="("+o.substring(1,4)),o.length>=5&&(l+=") "+o.substring(4,7)),o.length>=8&&(l+="-"+o.substring(7,9)),o.length>=10&&(l+="-"+o.substring(9,11))}else l=o.substring(0,6);t.value=l},m=e=>{8==e.keyCode&&1==c(e.target).length&&(e.target.value="")},p=e=>{let t=e.target,o=t.value.replace(/\s+/g," ").trim();/[!?.,а-яёА-ЯЁ0-9\s]/.test(o)||(t.value="",t.style.borderColor="#914848",d("Только кирилические символы и цифры!"),setTimeout((function(){t.style.borderColor="#dfdfdf"}),1e3))};fields.forEach(e=>{e.addEventListener("blur",n),"name"===e.name&&(e.addEventListener("input",u),e.addEventListener("keydown",s)),"tel"===e.name&&(e.addEventListener("input",i),e.addEventListener("keydown",m)),"comment"===e.name&&(e.addEventListener("input",p),e.addEventListener("keydown",s))}),form.forEach(e=>{e.addEventListener("submit",e=>{e.preventDefault();let t=e.currentTarget,o=t.querySelectorAll(".field");(e=>{data={};let t=e.querySelector("input[name='name']").value,o=e.querySelector("input[name='tel']").value,l=e.querySelector("textarea[name='comment']").value;data={name:t,tel:o,comment:l}})(t),(e=>{for(let t=0;t<e.length;t++)""===e[t].value&&(e[t].style.borderColor="#914848",setTimeout((function(){e[t].style.borderColor="#dfdfdf"}),1e3))})(o),async function(){(await fetch("form.php",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:l(data)})).text().then(e=>{d("Ошибка! Пустые поля!"===e?"Заполните пустые поля!":"Ошибка! Запрос не определен!"===e?"Ошибка при отправке заявки! Повторите отправку позже":"Ваша заявка отправлена!")})}(),(e=>{for(let t=0;t<e.length;t++)setTimeout((function(){e[t].style.borderColor="#dfdfdf",e[t].value=""}),1e3)})(o)})})}));